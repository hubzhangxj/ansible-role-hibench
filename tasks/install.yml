---
# RedHat related OSs
- name: Yum install {{ item }}
  yum:
    name={{ item }} state=installed
  when: "ansible_os_family == 'RedHat'"
  with_items:
  - bc
  - tar

- name: Download Maven package from official web
  get_url: url={{ maven_mirrors }}/{{ maven_version }}.tar.gz dest={{ home_dir }}/{{ maven_version }}.tar.gz force=no mode=0755
  register: result
  until: result|success
  retries: 1
  delay: 2 
  tags:
    - maven 

- name: Decompressed Maven package 
  unarchive: src={{ maven_home }}/{{ maven_version }}.tar.gz dest={{ home_dir }} creates={{ maven_home }}/{{ maven_version }} copy=no
  tags:
    - unmaven

- name: Git clone Hibench from github
  git:
    repo=https://github.com/intel-hadoop/HiBench.git 
    dest={{ hibench_home }}
    version={{ hibench_version }} 
  register: result
  until: result|success
  retries: 1
  delay: 2


#- file: dest={{ hibench_home }} src=/opt/hibench-{{ hibench_version }} state=link
- file: dest={{ maven_home }} src={{ maven_home }}/apache-maven-3.3.9 state=link
  tags:
    - link
#- file: dest=/opt/hibench src={{ hibench_home }} state=link
- name: Replace variables of {{ hibench_home }}/bin/build_all.sh 
  lineinfile: 
    path="{{ hibench_home }}/bin/build_all.sh" 
    regexp='mvn clean package' 
    line="mvn -Dspark=2.1 -Dscala=2.11 clean package"

